<table class="table1" id="cus_order_table">
  <tr>
    <th><div class="checkBox"><input type="checkbox" onclick="print_cus_orders_select_all(this)"/></div></th>
    <th>订单号</th>
    <th>消费时间</th>
    <th style="width:20%;">消费项目</th>
    <th>总价(元)</th>
    <th>优惠(元)</th>
    <th>成交(元)</th>
    <th>付款方式</th>
    <th>满意度</th>
    <th>开发票</th>
    <th>状态</th>
    <th>操作</th>
  </tr>
  <% @orders.each do |order| %>
    <tr name="cus_order_tr">
      <td><div class="checkBox"><input type="checkbox" id="line_<%= order.id %>" value="<%= order.id %>" onclick="print_cus_orders_select_one(this)"/></div></td>
      <td><%= order.code %></td>
      <td><%= order.created_at.strftime("%Y-%m-%d %H:%M:%S") %></td>
      <td style="width:20%;">
        <table width="100%" border="0" cellspacing="1" cellpadding="0" class="s_table">
          <tr name="cus_order_tr2">
            <td width="50%">名称</td>
            <td width="25%">单价</td>
            <td width="25%">数量</td>
          </tr>
          <% @product_hash[order.id].each do |p| %>
            <tr name="cus_order_tr2">
              <td><%= p.name %></td>
              <td><%= p.price %></td>
              <td><%= p.pro_num %></td>
            </tr>
          <% end if @product_hash[order.id] %>
        </table>
      </td>
      <% loss = limit_float(@pay_types[order.id].nil? ? 0 : @pay_types[order.id].select{|k,v|OrderPayType::LOSS.include? k}.values.inject(0){|sum,n|sum+n}) %>
      <%  fact = limit_float(order.price>loss ? order.price-loss : 0)%>
      <td><%= order.price %></td>
      <td><%= loss %></td>
      <td><%= fact%></td>
      <td><%= @order_pay_type[order.id].nil? ? "" : @order_pay_type[order.id].join(",") %></td>
      <td><%= Order::IS_PLEASED_NAME[order.is_pleased] %></td>
      <td><%= order.is_billing ? "是" : "否" %></td>
      <td><%= @product_hash[order.id].nil? ? "----" : Order::RETURN[@product_hash[order.id][0].return_types]%></td>
      <td>
        <a href="javascript:void(0)">回访</a>
        <% if (order.status == Order::STATUS[:BEEN_PAYMENT] || order.status == Order::STATUS[:FINISHED]) && order.return_types == Order::IS_RETURN[:NO] %>
          <a href="javascript:void(0)">退单</a>
        <% end %>
      </td>
    </tr>
  <% end %>
</table>
<% if @orders.any? %>
  <%= will_paginate @orders, :previous_label => "上一页", :next_label => "下一页", :class => "page",
    :id => "cus_order_page" %>
<% end %>
<script type="text/javascript">
  $(function(){
    var i = $("#cus_order_table").find("tr[name='cus_order_tr']").index($(this));
    if(i % 2 ==1 && i != 0){
      $(this).css("background","#f5f5f5");
    }else if(i % 2 ==0 && i != 0){
      $(this).removeAttr("style");
    };
    var tr2 =  $("#cus_order_table").find("tr[name='cus_order_tr2']");
    $.each(tr2, function(){
      $(this).removeAttr("style");
    });

    $("#cus_order_page").on("click", "a", function(){   //异步分页
      var url = $(this).attr("href");
      var type = 1;
      $.ajax({
        type: "get",
        url: url,
        dataType: "script",
        data: {type : type},
        error: function(){
          tishi("数据错误!");
        }
      });
      return false;
    })

  })
</script>